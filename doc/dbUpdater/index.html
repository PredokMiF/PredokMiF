<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>dbUpdater</h1><p>Данный модуль предназначен для выполнение разнообразных действий (задач) при старте проекта.
Главной особенность задачи в том, что она обязательно должна быть выполнена и только один раз.
Наиболее частое применение - обновление БД из заранее подготовленых файлов.
Например, есть несколько SQL скриптов которые должны быть последовательно выполнены, после чего можно стартовать приложение.
<br/>
Во время разработки появляются изменения в БД, которые должны быть выполнены на каждом сервере - мы добавляем соответствующие SQL скрипты (задачи)
и знаем, что перед стартом приложения БД будет обновлена (если этого еще не сделано). Это особенно актуально при большом количестве серверов.
Некоторые могут назвать этот механизм &quot;миграцией&quot;, на мой взгляд это не она, а сонхронизация структуры БД.</p>
<pre class="prettyprint source lang-js"><code>var DbUpdater = require('dbUpdater');
var dbConnStr = 'postgres://user:pass@localhost/dbName';

var dbUpdater = DbUpdater({
     taskReader: DbUpdater.TaskReaderFile(\/*{path: 'tasks'}*\/),
     taskSaver: DbUpdater.TaskSaverPostgreSQL({connString: dbConnStr\/*, dbTable: 'tasks'*\/}),
     taskExecutors: [
         DbUpdater.TaskExecPostgresFileJs({connString: dbConnStr}),
         DbUpdater.TaskExecPostgresFileSql({connString: dbConnStr})
     ]
});

dbUpdater.init(function (err) {
     if (err) {
         console.error('dbUpdater: ' + err);
     } else {
         console.log('dbUpdater done success!');
     }
});</code></pre><p>JS задача</p>
<pre class="prettyprint source lang-js"><code>// Имя файла tasks/20150506-0053-grigorchuk.postgres-file-js.js
var _ = require('lodash-node');
module.exports = function (client, cb) {
var sql = 'CREATE TABLE &quot;myyy&quot; (' +
     '   name character varying(256) NOT NULL, ' +
     '   md5 character varying(128) NOT NULL, ' +
     '   executed timestamp without time zone NOT NULL DEFAULT now()' +
     ');';
     client.query(sql, cb);
};</code></pre><p>SQL задача</p>
<pre class="prettyprint source lang-sql"><code>// Имя файла tasks/20150520-2359-grigorchuk.postgres-sql.sql
ALTER TABLE myyy ADD COLUMN id serial NOT NULL;
ALTER TABLE myyy ADD PRIMARY KEY (id);</code></pre></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DbUpdater.html">DbUpdater</a></li><li><a href="Executor.TaskExecAbstract.html">TaskExecAbstract</a></li><li><a href="Executor.TaskExecPostgresFileJs.html">TaskExecPostgresFileJs</a></li><li><a href="Executor.TaskExecPostgresFileSql.html">TaskExecPostgresFileSql</a></li><li><a href="Reader.TaskReaderAbstract.html">TaskReaderAbstract</a></li><li><a href="Reader.TaskReaderFile.html">TaskReaderFile</a></li><li><a href="Saver.TaskSaverAbstract.html">TaskSaverAbstract</a></li><li><a href="Saver.TaskSaverPostgreSQL.html">TaskSaverPostgreSQL</a></li></ul><h3>Namespaces</h3><ul><li><a href="Executor.html">Executor</a></li><li><a href="Reader.html">Reader</a></li><li><a href="Saver.html">Saver</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0</a> on Thu May 21 2015 23:44:34 GMT+0300 (Московское время (зима))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>